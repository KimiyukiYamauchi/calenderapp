{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/kanata/calenderapp/lib/microcms.ts"],"sourcesContent":["// lib/microcms.ts\n\nimport { createClient } from \"microcms-js-sdk\";\nimport type { Schedule, ScheduleInput, MicroCMSResponse } from \"./types\";\n\n// If microCMS environment variables are provided, use the real client.\n// Otherwise fall back to a simple in-memory store for local development.\nconst hasMicroCMSEnv =\n  !!process.env.MICROCMS_SERVICE_DOMAIN && !!process.env.MICROCMS_API_KEY;\n\nexport const client = hasMicroCMSEnv\n  ? createClient({\n      serviceDomain: process.env.MICROCMS_SERVICE_DOMAIN as string,\n      apiKey: process.env.MICROCMS_API_KEY as string,\n    })\n  : null;\n\n// In-memory fallback store for development when microCMS is not configured\nconst inMemoryStore: Schedule[] = [];\n\nfunction generateId() {\n  return `${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n}\n\n/**\n * 全予定を取得\n */\nexport async function getSchedules(\n  year?: number,\n  month?: number\n): Promise<Schedule[]> {\n  try {\n    // If microCMS client is not configured, use in-memory store\n    if (!client) {\n      if (year && month) {\n        const prefix = `${year}-${String(month).padStart(2, \"0\")}`;\n        return inMemoryStore.filter((s) => s.date.startsWith(prefix));\n      }\n\n      return [...inMemoryStore];\n    }\n\n    let filters = \"\";\n\n    if (year && month) {\n      // 指定された月の予定のみを取得\n      const startDate = `${year}-${String(month).padStart(2, \"0\")}-01`;\n      const endDate = `${year}-${String(month).padStart(2, \"0\")}-31`;\n      filters = `date[greater_than]${startDate}[and]date[less_than]${endDate}`;\n    }\n\n    const response = await client.get<MicroCMSResponse<Schedule>>({\n      endpoint: \"schedules\",\n      queries: {\n        limit: 100,\n        orders: \"date\",\n        ...(filters && { filters }),\n      },\n    });\n\n    return response.contents;\n  } catch (error) {\n    console.error(\"Failed to fetch schedules:\", error);\n    throw error;\n  }\n}\n\n/**\n * 特定の予定を取得\n */\nexport async function getSchedule(id: string): Promise<Schedule> {\n  try {\n    if (!client) {\n      const found = inMemoryStore.find((s) => s.id === id);\n      if (!found) throw new Error(`Schedule ${id} not found`);\n      return found;\n    }\n\n    const schedule = await client.get<Schedule>({\n      endpoint: \"schedules\",\n      contentId: id,\n    });\n\n    return schedule;\n  } catch (error) {\n    console.error(`Failed to fetch schedule ${id}:`, error);\n    throw error;\n  }\n}\n\n/**\n * 予定を作成\n */\nexport async function createSchedule(data: ScheduleInput): Promise<Schedule> {\n  try {\n    if (!client) {\n      const id = generateId();\n      const now = new Date().toISOString();\n      const schedule: Schedule = {\n        ...data,\n        id,\n        completed: data.completed ?? false,\n        createdAt: now,\n        updatedAt: now,\n      } as Schedule;\n      inMemoryStore.push(schedule);\n      return schedule;\n    }\n\n    const response = await client.create({\n      endpoint: \"schedules\",\n      content: {\n        ...data,\n        completed: data.completed ?? false,\n      },\n    });\n\n    return {\n      ...data,\n      id: response.id,\n      completed: data.completed ?? false,\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n    } as Schedule;\n  } catch (error) {\n    console.error(\"Failed to create schedule:\", error);\n    throw error;\n  }\n}\n\n/**\n * 予定を更新\n */\nexport async function updateSchedule(\n  id: string,\n  data: Partial<ScheduleInput>\n): Promise<Schedule> {\n  try {\n    if (!client) {\n      const idx = inMemoryStore.findIndex((s) => s.id === id);\n      if (idx === -1) throw new Error(`Schedule ${id} not found`);\n      const updated = {\n        ...inMemoryStore[idx],\n        ...data,\n        updatedAt: new Date().toISOString(),\n      } as Schedule;\n      inMemoryStore[idx] = updated;\n      return updated;\n    }\n\n    await client.update({\n      endpoint: \"schedules\",\n      contentId: id,\n      content: data,\n    });\n\n    // 更新後のデータを取得\n    return await getSchedule(id);\n  } catch (error) {\n    console.error(`Failed to update schedule ${id}:`, error);\n    throw error;\n  }\n}\n\n/**\n * 予定を削除\n */\nexport async function deleteSchedule(id: string): Promise<void> {\n  try {\n    if (!client) {\n      const idx = inMemoryStore.findIndex((s) => s.id === id);\n      if (idx === -1) throw new Error(`Schedule ${id} not found`);\n      inMemoryStore.splice(idx, 1);\n      return;\n    }\n\n    await client.delete({\n      endpoint: \"schedules\",\n      contentId: id,\n    });\n  } catch (error) {\n    console.error(`Failed to delete schedule ${id}:`, error);\n    throw error;\n  }\n}\n\n/**\n * 複数の予定を一括作成\n */\nexport async function createScheduleBulk(\n  schedules: ScheduleInput[]\n): Promise<Schedule[]> {\n  try {\n    // createSchedule already handles microCMS vs in-memory fallback\n    const results = await Promise.all(\n      schedules.map((schedule) => createSchedule(schedule))\n    );\n    return results;\n  } catch (error) {\n    console.error(\"Failed to create schedules in bulk:\", error);\n    throw error;\n  }\n}\n\n/**\n * 日付範囲で予定を取得\n */\nexport async function getSchedulesByDateRange(\n  startDate: string,\n  endDate: string\n): Promise<Schedule[]> {\n  try {\n    if (!client) {\n      return inMemoryStore.filter(\n        (s) => s.date > startDate && s.date < endDate\n      );\n    }\n\n    const filters = `date[greater_than]${startDate}[and]date[less_than]${endDate}`;\n\n    const response = await client.get<MicroCMSResponse<Schedule>>({\n      endpoint: \"schedules\",\n      queries: {\n        limit: 100,\n        orders: \"date\",\n        filters,\n      },\n    });\n\n    return response.contents;\n  } catch (error) {\n    console.error(\"Failed to fetch schedules by date range:\", error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///home/kanata/calenderapp/app/api/schedules/route.ts"],"sourcesContent":["// app/api/schedules/route.ts\n\nimport { NextRequest, NextResponse } from \"next/server\";\nimport {\n  getSchedules,\n  createSchedule,\n  createScheduleBulk,\n} from \"@/lib/microcms\";\nimport type { ScheduleInput, APIResponse, Schedule } from \"@/lib/types\";\n\n/**\n * GET /api/schedules\n * 予定一覧を取得\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const year = searchParams.get(\"year\");\n    const month = searchParams.get(\"month\");\n\n    const schedules = await getSchedules(\n      year ? parseInt(year) : undefined,\n      month ? parseInt(month) : undefined\n    );\n\n    return NextResponse.json<APIResponse<Schedule[]>>({\n      success: true,\n      data: schedules,\n    });\n  } catch (error) {\n    console.error(\"Failed to fetch schedules:\", error);\n\n    return NextResponse.json<APIResponse<null>>(\n      {\n        success: false,\n        error: \"予定の取得に失敗しました\",\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/schedules\n * 予定を作成（単体または一括）\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n\n    // 一括作成の場合\n    if (Array.isArray(body)) {\n      const schedules = await createScheduleBulk(body as ScheduleInput[]);\n\n      return NextResponse.json<APIResponse<Schedule[]>>(\n        {\n          success: true,\n          data: schedules,\n        },\n        { status: 201 }\n      );\n    }\n\n    // 単体作成の場合\n    const schedule = await createSchedule(body as ScheduleInput);\n\n    return NextResponse.json<APIResponse<Schedule>>(\n      {\n        success: true,\n        data: schedule,\n      },\n      { status: 201 }\n    );\n  } catch (error) {\n    console.error(\"Failed to create schedule:\", error);\n\n    return NextResponse.json<APIResponse<null>>(\n      {\n        success: false,\n        error: \"予定の作成に失敗しました\",\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;;;;AAE7B;AACA;;;AAWO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,MAAM,QAAQ,aAAa,GAAG,CAAC;QAE/B,MAAM,YAAY,MAAM,IAAA,gJAAY,EAClC,OAAO,SAAS,QAAQ,WACxB,QAAQ,SAAS,SAAS;QAG5B,OAAO,gJAAY,CAAC,IAAI,CAA0B;YAChD,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAE5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAMO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,UAAU;QACV,IAAI,MAAM,OAAO,CAAC,OAAO;YACvB,MAAM,YAAY,MAAM,IAAA,sJAAkB,EAAC;YAE3C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,MAAM;YACR,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,UAAU;QACV,MAAM,WAAW,MAAM,IAAA,kJAAc,EAAC;QAEtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,MAAM;QACR,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAE5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}