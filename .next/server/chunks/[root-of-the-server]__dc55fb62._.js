module.exports=[22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},16739,e=>{"use strict";var t=e.i(8215),r=e.i(73275),a=e.i(8755),n=e.i(64658),o=e.i(38603),i=e.i(75680),s=e.i(23080),l=e.i(76842),c=e.i(56182),d=e.i(7762),u=e.i(9630),p=e.i(27055),h=e.i(84519),g=e.i(57911),f=e.i(76138),m=e.i(37216),R=e.i(93695);e.i(75499);var w=e.i(97262),T=e.i(97786),x=e.i(22734),y=e.i(14747),v=e.i(46786);async function C(t){try{let r=Buffer.from(t,"base64"),a=v.default.tmpdir(),n=`ocr_input_${Date.now()}.png`,o=y.default.join(a,n);await x.default.promises.writeFile(o,r);let i=await e.A(84703),s=await i.recognize(o,{lang:"jpn+eng",oem:1,psm:3});try{await x.default.promises.unlink(o)}catch{}return s}catch(e){throw console.error("Tesseract OCR error:",e),e}}async function E(){return T.NextResponse.json({success:!0,data:[],info:"OCR endpoint (POST) is available"})}async function A(t){try{let r=!!process.env.ANTHROPIC_API_KEY;r||console.warn("Anthropic API key not configured — will use local Tesseract fallback");let a=await t.formData(),n=a.get("image");if(!n)return T.NextResponse.json({success:!1,error:"画像がアップロードされていません"},{status:400});let o=n.match(/data:([^;]+);/),i=o?o[1]:"image/jpeg",s=n.split(",")[1]||n,l=a.get("name")||"",c=l?`

注意: 画像中に氏名や担当者名が記載されている場合は、名前が "${l}" に該当する予定（シフト）のみを抽出してください。該当がない場合は空配列を返してください。`:"",d=`この画像からスケジュール・予定情報を抽出してください。

必ず返す形式: JSON配列。配列の各要素は少なくとも title を含むオブジェクトで、可能なら以下フィールドを出力してください: date, startTime, endTime, title, description, category, assignedTo (配列), rawText (文字列)。assignedTo が空でも空配列を返してください。

出力は"JSONのみ"にしてください。余計な説明や注釈、マークダウンは一切含めないでください。日付や時間が読み取れない場合は null を使用し、予定が無ければ空配列 [] を返してください。

以下に複数の具体例を示します。必ず同じフィールド名で返してください。

例1（複数名・日付あり）:
[
  {
    "date": "2025-11-20",
    "startTime": "09:00",
    "endTime": "12:00",
    "title": "会議（営業部）",
    "description": "来期予算の打ち合わせ",
    "category": "work",
    "assignedTo": ["田中 太郎", "佐藤 花子"],
    "rawText": "11/20 9:00-12:00 田中/佐藤 会議 来期予算"
  }
]

例2（氏名が画像に明記され、該当者のみ抽出）:
[
  {
    "date": "2025-11-21",
    "startTime": "14:00",
    "endTime": "15:00",
    "title": "面談",
    "description": "新人面談",
    "category": "work",
    "assignedTo": ["山田 太郎"],
    "rawText": "11/21 山田 太郎 14:00 面談"
  }
]

例3（日時読み取り困難）:
[
  {
    "date": null,
    "startTime": null,
    "endTime": null,
    "title": "納期未定の打ち合わせ",
    "description": "詳細は未記入",
    "category": "other",
    "assignedTo": [],
    "rawText": "未定 打ち合わせ"
  }
]

注: assignedTo が得られない場合でも空の配列を返すこと、rawText には可能な限り元テキスト断片を入れることを徹底してください。`+c,u=null;if(r)try{let{default:t}=await e.A(63423),r=new t({apiKey:process.env.ANTHROPIC_API_KEY});u=await r.messages.create({model:"claude-sonnet-4-20250514",max_tokens:2e3,messages:[{role:"user",content:[{type:"image",source:{type:"base64",media_type:i,data:s}},{type:"text",text:d}]}]})}catch(e){console.error("Anthropic import/call error - falling back to Tesseract:",e),u=null}let p=[];if(u){let e=u.content.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join("");try{let t=e.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim();p=JSON.parse(t),Array.isArray(p)||(p=[p])}catch(e){console.error("JSON parse error from LLM output:",e),p=[]}}else try{let e=await C(s),t=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),r=l?l.trim().toLowerCase().replace(/\s+/g,""):"",a=e=>e.toLowerCase().replace(/\s+/g,"");if(r){for(let e of t)if(a(e).includes(r)){let t=e.match(/(20\d{2}[-\/.]\d{1,2}[-\/.]\d{1,2})|(\d{1,2}\/\d{1,2})/),r=e.match(/(\d{1,2}:\d{2})/g),a=t?t[1]||t[2]:null,n=r?r[0]:null,o=r&&r.length>1?r[1]:null;p.push({date:a||void 0,startTime:n||void 0,endTime:o||void 0,title:e,description:"",category:"other",assignedTo:[l],rawText:e})}p=p||[]}else{let r=t[0]||e;p.push({title:r||"抽出された予定",description:"",category:"other",assignedTo:[],rawText:e})}}catch(e){return console.error("Tesseract fallback error:",e),T.NextResponse.json({success:!1,error:"OCR処理（Tesseract）中にエラーが発生しました"},{status:500})}if(l&&l.trim()){let e=l.trim(),t=e=>e?e.replace(/[-]/g,e=>e).replace(/[！-～]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).normalize("NFKC").toLowerCase().replace(/\s+/g,"").replace(/[\p{P}\p{S}]/gu,""):"",r=(e,t)=>{let r=Array.from({length:e.length+1},()=>Array(t.length+1).fill(0));for(let t=0;t<=e.length;t++)r[t][0]=t;for(let e=0;e<=t.length;e++)r[0][e]=e;for(let a=1;a<=e.length;a++)for(let n=1;n<=t.length;n++){let o=+(e[a-1]!==t[n-1]);r[a][n]=Math.min(r[a-1][n]+1,r[a][n-1]+1,r[a-1][n-1]+o)}return r[e.length][t.length]},a=t(e);p=p.filter(e=>{let n=e.assignedTo;if(Array.isArray(n)&&n.length>0){for(let e of n){let n=t(e);if(!n)continue;if(n.includes(a)||a.includes(n))return!0;let o=Math.max(1,Math.floor(.3*Math.max(a.length,n.length)));if(r(n,a)<=o)return!0}return!1}for(let n of[e.title,e.description,e.rawText].filter(Boolean).map(e=>t(String(e))))if(n.includes(a)||a.includes(n)||r(n,a)<=Math.max(1,Math.floor(.25*a.length)))return!0;return!1})}return T.NextResponse.json({success:!0,data:p})}catch(e){return console.error("OCR processing error:",e),T.NextResponse.json({success:!1,error:"OCR処理中にエラーが発生しました"},{status:500})}}e.s(["GET",()=>E,"POST",()=>A],11607);var N=e.i(11607);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/ocr/route",pathname:"/api/ocr",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/calenderapp/app/api/ocr/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:P,workUnitAsyncStorage:S,serverHooks:_}=O;function b(){return(0,a.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:S})}async function M(e,t,a){O.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let T="/api/ocr/route";T=T.replace(/\/index$/,"")||"/";let x=await O.prepare(e,t,{srcPage:T,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:v,nextConfig:C,parsedUrl:E,isDraftMode:A,prerenderManifest:N,routerServerContext:P,isOnDemandRevalidate:S,revalidateOnlyGenerated:_,resolvedPathname:b,clientReferenceManifest:M,serverActionsManifest:k}=x,I=(0,l.normalizeAppPath)(T),H=!!(N.dynamicRoutes[I]||N.routes[b]),j=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,E,!1):t.end("This page could not be found"),null);if(H&&!A){let e=!!N.routes[b],t=N.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await j();throw new R.NoFallbackError}}let q=null;!H||O.isDev||A||(q="/index"===(q=b)?"/":q);let U=!0===O.isDev||!H,D=H&&!U;k&&M&&(0,i.setReferenceManifestsSingleton)({page:T,clientReferenceManifest:M,serverActionsManifest:k,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:k})});let K=e.method||"GET",$=(0,o.getTracer)(),F=$.getActiveScopeSpan(),L={params:v,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>O.onRequestError(e,t,a,P)},sharedContext:{buildId:y}},B=new c.NodeNextRequest(e),G=new c.NodeNextResponse(t),J=d.NextRequestAdapter.fromNodeNextRequest(B,(0,d.signalFromNodeResponse)(t));try{let i=async e=>O.handle(J,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${K} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${K} ${T}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let c=async({previousCacheEntry:r})=>{try{if(!s&&S&&_&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!H)return await (0,h.sendResponse)(B,G,o,L.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:S})},P),t}},d=await O.handleResponse({req:e,nextConfig:C,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:_,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:s});if(!H)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",S?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&H||u.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(B,G,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};F?await l(F):await $.withPropagatedContext(e.headers,()=>$.trace(u.BaseServerSpan.handleRequest,{spanName:`${K} ${T}`,kind:o.SpanKind.SERVER,attributes:{"http.method":K,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:S})}),H)throw t;return await (0,h.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>b,"routeModule",()=>O,"serverHooks",()=>_,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>S],16739)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__dc55fb62._.js.map