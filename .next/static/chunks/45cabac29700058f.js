(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78971,(e,t,l)=>{t.exports=e.r(37911)},90261,e=>{"use strict";e.s(["CATEGORIES",0,[{value:"work",label:"ä»•äº‹",defaultColor:"#3B82F6"},{value:"private",label:"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ",defaultColor:"#10B981"},{value:"event",label:"ã‚¤ãƒ™ãƒ³ãƒˆ",defaultColor:"#F59E0B"},{value:"other",label:"ãã®ä»–",defaultColor:"#8B5CF6"}]])},35442,e=>{"use strict";function t(e,t,a){let r=[],s=new Date(e,t-1,1),n=new Date(e,t,0),u=new Date;u.setHours(0,0,0,0);let d=s.getDay(),o=new Date(e,t-1,0).getDate();for(let s=d-1;s>=0;s--){let n=new Date(e,t-2,o-s);r.push({date:n,isCurrentMonth:!1,isToday:!1,schedules:l(n,a)})}for(let s=1;s<=n.getDate();s++){let n=new Date(e,t-1,s),d=new Date(n);d.setHours(0,0,0,0),r.push({date:n,isCurrentMonth:!0,isToday:d.getTime()===u.getTime(),schedules:l(n,a)})}let i=7-r.length%7;if(i<7)for(let s=1;s<=i;s++){let n=new Date(e,t,s);r.push({date:n,isCurrentMonth:!1,isToday:!1,schedules:l(n,a)})}return r}function l(e,t){let l=a(e);return t.filter(e=>e.date===l).sort((e,t)=>e.startTime.localeCompare(t.startTime))}function a(e){let t=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${l}-${a}`}function r(e,t){return`${e}å¹´${t}æœˆ`}function s(e){return["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][e]}function n(e){return!!/^\d{4}-\d{2}-\d{2}$/.test(e)&&!isNaN((function(e){let[t,l,a]=e.split("-").map(Number);return new Date(t,l-1,a)})(e).getTime())}function u(e){if(!/^\d{2}:\d{2}$/.test(e))return!1;let[t,l]=e.split(":").map(Number);return t>=0&&t<24&&l>=0&&l<60}function d(e,t){return e<t}e.s(["formatDate",()=>a,"generateCalendarDays",()=>t,"getDayName",()=>s,"getMonthName",()=>r,"isValidDate",()=>n,"isValidTime",()=>u,"isValidTimeRange",()=>d])},2263,e=>{e.v({button:"ImageUpload-module__5r8nlq__button",buttonPrimary:"ImageUpload-module__5r8nlq__buttonPrimary",buttonSecondary:"ImageUpload-module__5r8nlq__buttonSecondary",container:"ImageUpload-module__5r8nlq__container",dragOver:"ImageUpload-module__5r8nlq__dragOver",error:"ImageUpload-module__5r8nlq__error",fileInput:"ImageUpload-module__5r8nlq__fileInput",loading:"ImageUpload-module__5r8nlq__loading",loadingSpinner:"ImageUpload-module__5r8nlq__loadingSpinner",loadingText:"ImageUpload-module__5r8nlq__loadingText",preview:"ImageUpload-module__5r8nlq__preview",previewActions:"ImageUpload-module__5r8nlq__previewActions",previewImage:"ImageUpload-module__5r8nlq__previewImage",resultItem:"ImageUpload-module__5r8nlq__resultItem",resultItemBadge:"ImageUpload-module__5r8nlq__resultItemBadge",resultItemField:"ImageUpload-module__5r8nlq__resultItemField",resultItemHeader:"ImageUpload-module__5r8nlq__resultItemHeader",resultItemInput:"ImageUpload-module__5r8nlq__resultItemInput",resultItemLabel:"ImageUpload-module__5r8nlq__resultItemLabel",resultItemRow:"ImageUpload-module__5r8nlq__resultItemRow",resultItemSelect:"ImageUpload-module__5r8nlq__resultItemSelect",resultItemTextarea:"ImageUpload-module__5r8nlq__resultItemTextarea",resultItemTitle:"ImageUpload-module__5r8nlq__resultItemTitle",resultItemValue:"ImageUpload-module__5r8nlq__resultItemValue",results:"ImageUpload-module__5r8nlq__results",resultsCount:"ImageUpload-module__5r8nlq__resultsCount",resultsHeader:"ImageUpload-module__5r8nlq__resultsHeader",resultsList:"ImageUpload-module__5r8nlq__resultsList",resultsTitle:"ImageUpload-module__5r8nlq__resultsTitle",saveButtons:"ImageUpload-module__5r8nlq__saveButtons",spin:"ImageUpload-module__5r8nlq__spin",success:"ImageUpload-module__5r8nlq__success",title:"ImageUpload-module__5r8nlq__title",uploadArea:"ImageUpload-module__5r8nlq__uploadArea",uploadHint:"ImageUpload-module__5r8nlq__uploadHint",uploadIcon:"ImageUpload-module__5r8nlq__uploadIcon",uploadText:"ImageUpload-module__5r8nlq__uploadText"})},15097,e=>{"use strict";var t=e.i(45802),l=e.i(71197),a=e.i(78971),r=e.i(90261),s=e.i(35442),n=e.i(2263);function u(){let e=(0,a.useRouter)(),u=(0,l.useRef)(null),[d,o]=(0,l.useState)(null),[i,m]=(0,l.useState)(null),[c,_]=(0,l.useState)(""),[p,g]=(0,l.useState)(!1),[f,h]=(0,l.useState)(!1),[I,v]=(0,l.useState)([]),[x,T]=(0,l.useState)([]),[j,N]=(0,l.useState)(null),[y,b]=(0,l.useState)(!1),C=e=>{if(!e.type.startsWith("image/"))return void alert("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠžã—ã¦ãã ã•ã„");o(e),N(null),b(!1);let t=new FileReader;t.onload=e=>{m(e.target?.result)},t.readAsDataURL(e)},U=async()=>{if(d&&i)try{h(!0),N(null);let t=new FormData;t.append("image",i),t.append("name",c||"");let l=await fetch("/api/ocr",{method:"POST",body:t}),a=await l.json();if(a.success&&a.data){v(a.data);let t=(0,s.formatDate)(new Date),l=a.data.map(e=>{let l=r.CATEGORIES.find(t=>t.value===e.category);return{date:e.date||t,startTime:e.startTime||"09:00",endTime:e.endTime||"10:00",title:e.title,description:e.description||"",category:e.category||"other",color:l?.defaultColor||r.CATEGORIES[3].defaultColor,completed:!1}}),n=e=>(e||"").normalize("NFKC").toLowerCase().replace(/\s+/g,"").replace(/[\p{P}\p{S}]/gu,""),u=(e,t)=>{let l=Array.from({length:e.length+1},()=>Array(t.length+1).fill(0));for(let t=0;t<=e.length;t++)l[t][0]=t;for(let e=0;e<=t.length;e++)l[0][e]=e;for(let a=1;a<=e.length;a++)for(let r=1;r<=t.length;r++){let s=+(e[a-1]!==t[r-1]);l[a][r]=Math.min(l[a-1][r]+1,l[a][r-1]+1,l[a-1][r-1]+s)}return l[e.length][t.length]},d=l;if(c&&c.trim()){let e=n(c.trim());d=l.filter((t,l)=>((t,l)=>{if(l?.assignedTo&&l.assignedTo.length>0){for(let t of l.assignedTo){let l=n(t);if(!l)continue;if(l.includes(e)||e.includes(l))return!0;let a=Math.max(1,Math.floor(.3*Math.max(e.length,l.length)));if(u(l,e)<=a)return!0}return!1}for(let a of[t.title,t.description,l&&l.rawText||""].filter(Boolean).map(e=>n(String(e))))if(a.includes(e)||e.includes(a)||u(a,e)<=Math.max(1,Math.floor(.25*e.length)))return!0;return!1})(t,a.data[l]))}if(T(d),d.length>0)try{h(!0);let t=await fetch("/api/schedules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),l=await t.json();if(l.success){let t=d[0].date;e.push(`/?focus=${encodeURIComponent(t)}`),e.refresh();return}N(l.error||"è‡ªå‹•ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}catch(e){console.error("Auto-save error:",e),N("è‡ªå‹•ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}finally{h(!1)}}else N(a.error||"äºˆå®šã®æŠ½å‡ºã«å¤±æ•—ã—ã¾ã—ãŸ")}catch(e){console.error("OCR error:",e),N("OCRå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}finally{h(!1)}},S=!!c.trim()&&!!d&&!!i,q=(e,t,l)=>{T(a=>{let s=[...a];if(s[e]={...s[e],[t]:l},"category"===t){let t=r.CATEGORIES.find(e=>e.value===l);t&&(s[e].color=t.defaultColor)}return s})},w=async()=>{if(0!==x.length){if(x.some(e=>!e.title.trim()||!e.date||!e.startTime||!e.endTime))return void alert("ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");try{h(!0),N(null);let t=await fetch("/api/schedules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)}),l=await t.json();l.success?(b(!0),setTimeout(()=>{e.push("/schedules"),e.refresh()},1500)):N(l.error||"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}catch(e){console.error("Save error:",e),N("ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}finally{h(!1)}}},D=()=>{o(null),m(null),v([]),T([]),N(null),b(!1),u.current&&(u.current.value="")};return(0,t.jsxs)("div",{className:n.default.container,children:[(0,t.jsx)("h1",{className:n.default.title,children:"ç”»åƒã‹ã‚‰äºˆå®šã‚’èª­ã¿è¾¼ã‚€"}),!d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:`${n.default.uploadArea} ${p?n.default.dragOver:""}`,onClick:()=>{u.current?.click()},onDragOver:e=>{e.preventDefault(),g(!0)},onDragLeave:()=>{g(!1)},onDrop:e=>{e.preventDefault(),g(!1);let t=e.dataTransfer.files[0];t&&C(t)},children:[(0,t.jsx)("div",{className:n.default.uploadIcon,children:"ðŸ“·"}),(0,t.jsx)("div",{className:n.default.uploadText,children:"ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã§ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}),(0,t.jsx)("div",{className:n.default.uploadHint,children:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚„æ‰‹å¸³ã®å†™çœŸã‹ã‚‰äºˆå®šã‚’è‡ªå‹•æŠ½å‡ºã—ã¾ã™"})]}),(0,t.jsx)("input",{ref:u,type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];t&&C(t)},className:n.default.fileInput})]}),(0,t.jsxs)("div",{style:{marginTop:12},children:[(0,t.jsx)("label",{style:{display:"block",marginBottom:6},children:"åå‰ï¼ˆæŠ½å‡ºå¯¾è±¡ï¼‰"}),(0,t.jsx)("input",{type:"text",value:c,onChange:e=>_(e.target.value),placeholder:"ä¾‹: ç”°ä¸­ å¤ªéƒŽ",style:{padding:8,width:"100%",maxWidth:360}})]}),d&&i&&!f&&0===x.length&&(0,t.jsxs)("div",{className:n.default.preview,children:[(0,t.jsx)("img",{src:i,alt:"Preview",className:n.default.previewImage}),(0,t.jsxs)("div",{className:n.default.previewActions,children:[(0,t.jsx)("button",{className:`${n.default.button} ${n.default.buttonSecondary}`,onClick:D,children:"åˆ¥ã®ç”»åƒã‚’é¸æŠž"}),(0,t.jsx)("button",{className:`${n.default.button} ${n.default.buttonPrimary}`,onClick:U,disabled:!S,title:S?"äºˆå®šã‚’æŠ½å‡º":"ç”»åƒã¨æŠ½å‡ºå¯¾è±¡ã®åå‰ã‚’æŒ‡å®šã—ã¦ãã ã•ã„",children:"äºˆå®šã‚’æŠ½å‡º"})]})]}),f&&(0,t.jsxs)("div",{className:n.default.loading,children:[(0,t.jsx)("div",{className:n.default.loadingSpinner}),(0,t.jsx)("div",{className:n.default.loadingText,children:0===x.length?"ç”»åƒã‚’è§£æžä¸­...":"äºˆå®šã‚’ä¿å­˜ä¸­..."})]}),j&&(0,t.jsx)("div",{className:n.default.error,children:j}),y&&(0,t.jsx)("div",{className:n.default.success,children:"äºˆå®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼äºˆå®šä¸€è¦§ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™..."}),x.length>0&&!y&&(0,t.jsxs)("div",{className:n.default.results,children:[(0,t.jsxs)("div",{className:n.default.resultsHeader,children:[(0,t.jsx)("h2",{className:n.default.resultsTitle,children:"æŠ½å‡ºã•ã‚ŒãŸäºˆå®š"}),(0,t.jsxs)("p",{className:n.default.resultsCount,children:[x.length,"ä»¶ã®äºˆå®šãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ"]})]}),(0,t.jsx)("div",{className:n.default.resultsList,children:x.map((e,l)=>{let a=r.CATEGORIES.find(t=>t.value===e.category);return(0,t.jsxs)("div",{className:n.default.resultItem,children:[(0,t.jsxs)("div",{className:n.default.resultItemHeader,children:[(0,t.jsx)("input",{type:"text",value:e.title,onChange:e=>q(l,"title",e.target.value),className:n.default.resultItemTitle,style:{border:"none",outline:"none",width:"100%"}}),(0,t.jsx)("span",{className:n.default.resultItemBadge,style:{backgroundColor:e.color},children:a?.label})]}),(0,t.jsxs)("div",{className:n.default.resultItemRow,children:[(0,t.jsxs)("div",{className:n.default.resultItemField,children:[(0,t.jsx)("label",{className:n.default.resultItemLabel,children:"æ—¥ä»˜"}),(0,t.jsx)("input",{type:"date",value:e.date,onChange:e=>q(l,"date",e.target.value),className:n.default.resultItemInput})]}),(0,t.jsxs)("div",{className:n.default.resultItemField,children:[(0,t.jsx)("label",{className:n.default.resultItemLabel,children:"é–‹å§‹æ™‚é–“"}),(0,t.jsx)("input",{type:"time",value:e.startTime,onChange:e=>q(l,"startTime",e.target.value),className:n.default.resultItemInput})]}),(0,t.jsxs)("div",{className:n.default.resultItemField,children:[(0,t.jsx)("label",{className:n.default.resultItemLabel,children:"çµ‚äº†æ™‚é–“"}),(0,t.jsx)("input",{type:"time",value:e.endTime,onChange:e=>q(l,"endTime",e.target.value),className:n.default.resultItemInput})]}),(0,t.jsxs)("div",{className:n.default.resultItemField,children:[(0,t.jsx)("label",{className:n.default.resultItemLabel,children:"ã‚«ãƒ†ã‚´ãƒªãƒ¼"}),(0,t.jsx)("select",{value:e.category,onChange:e=>q(l,"category",e.target.value),className:n.default.resultItemSelect,children:r.CATEGORIES.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:n.default.resultItemField,children:[(0,t.jsx)("label",{className:n.default.resultItemLabel,children:"è©³ç´°"}),(0,t.jsx)("textarea",{value:e.description,onChange:e=>q(l,"description",e.target.value),className:n.default.resultItemTextarea,placeholder:"äºˆå®šã®è©³ç´°..."})]})]},l)})}),(0,t.jsxs)("div",{className:n.default.saveButtons,children:[(0,t.jsx)("button",{className:`${n.default.button} ${n.default.buttonSecondary}`,onClick:D,disabled:f,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),(0,t.jsx)("button",{className:`${n.default.button} ${n.default.buttonPrimary}`,onClick:w,disabled:f,children:"ã™ã¹ã¦ä¿å­˜"})]})]})]})}e.s(["default",()=>u])}]);